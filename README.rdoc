= arver

* http://github.com/#{github_username}/#{project_name}

== DESCRIPTION:

arver is a tool to open crypted harddisks.

Imagine you are a collective with several admin members. The servers have LUKS encrypted devices.
Either
* you would need 1 password for every device which everyone needs to know
or 
* you use arver! Arver has 1 password for each device and for each member. This password is stored encrypted with the personal gpg-key in the data directory. The admins only need to know the password to the their own gpg secret key.

=== Details ===
* Create:
** arver creates a password and stores it in a slot on the server. the slot is defined in data/users. the password is then encrypted with the personal key (key defined in data/users) and stored in data/keys/USERNAME/key_X (X incremented with the use of "arver --create")

* Open
** arver gets the password with decrypting the data/keys/USERNAME/key_X files and applies it to the server

* Add-User
** arver creates a password and stores it in the (other) user-slot. The password is encrypted for the other user.
** with the option --ask-password, a password (ie. the oldpassword stored in Slot 0) can be entered) -> MIGRATION

== FEATURES/PROBLEMS:

arver supports up to 8 member passwords (LUKS has 8 slots (LUKS NUMKEYS))

=== Problems ===

* GPGME and gpg-agent
If arver asks several times for the password, something is wrong with your gpg-agent installation.

To test if gpg-agent is working, use gpg or better gpg2 to decrypt a file, it will tell you about the gpg-erorrs.

You might look at the following program:
** http://dougbarton.us/PGP/gpg-agent.html
If you install it like dougbarton recomends, you need to make sure GPG_AGENT_INFO is accessible within the arver script. You can do this with the following entry in .bashrc (part of the .xsession entry)
 if [ -r "${HOME}/.gpg-agent-info" ]; then
  . ${HOME}/.gpg-agent-info
  export GPG_AGENT_INFO SSH_AUTH_SOCK SSH_AGENT_PID
 fi

Other helpful infos:
** http://live.gnome.org/GnomeKeyring/Ssh
** see http://thefunkcorner.blogspot.com/2008/06/using-gnupg-agent-on-console.html
** http://fedoraproject.org/wiki/DocsProject/UsingGpg/CreatingKeys#head-afa09100f0b78b006dfdc62b5d9e0f315ddabfaf

== SYNOPSIS:

  arver -u user -c datastore -t server/harddisk --create
  arver -u user -c datastore -t server/harddisk --open
  arver -u user -c datastore -t server/harddisk --close

  arver -u user -c datastore -t server/harddisk --add-user test

  arver -u user -c datastore -t server/harddisk --del-user test
  #  deluser was called with target /location/server/harddisk and user test (slot-no 7)
  #  would call (if implemented :( )):
  #  "echo \"***\" | ssh server \"cryptsetup --batch-mode luksKillSlot /dev/storage/harddisk 7\""

== REQUIREMENTS:

* needs cryptsetup-luks >= 1.0.5 (to work properly with slots)

== INSTALL:

* sudo apt-get install ruby1.8-dev (for mkmf)
* sudo apt-get install libgpgme11-dev (for gpgme-config)

* sudo gem install i18n
  # i18n needs gem version >= 1.3.6. For installation see http://stackoverflow.com/questions/2777831/how-can-i-get-rubygems-1-3-6-on-ubuntu-10-4
* sudo gem install activesupport gpgme highline

== LICENSE:

(The MIT License)

Copyright (c) 2010 arver

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
'Software'), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
